(function(e){"use strict";const n=new URLSearchParams(e.location.search).has("zbo_debug"),s=parseInt(new URLSearchParams(e.location.search).get("zbo_debug"))||0;var o={getURL:function(){try{return e.parent.location.href+e.parent.location.hash}catch{return e.location.href+e.location.hash}},getURLPath:function(){var t=e.location.hash;try{t=e.parent.location.hash}finally{return e.location.pathname+t.substring(0,t.indexOf("?")>=0?t.indexOf("?"):t.length)}},getURLPathFull:function(){try{return e.location.pathname+e.parent.location.search+e.parent.location.hash}catch{return e.location.pathname+e.location.search+e.location.hash}}},t={var_regex:/\{\{\s*(\w[\w\s-]*)(?<!\s)\s*\}\}/gm,var_fn_regex:/(function\s*\(\))(\s*\{)(.*)(\}\s*)/,tags:[],executedTagIDs:[],varsInit:!0,vars:{},varsDependencies:{},triggers:{},_events:[],is_debug:n,debug_value:s,interId:null,init:function(){let t=!0;for(let n in e._zbo)if(n!="register")if(t=!1,this._events[n]=this._events[n]||[],typeof e._zbo[n]=="object")for(let t of e._zbo[n])this._events[n].push(t||{});else this._events[n].push(e._zbo[n]||{});t&&this.register("afterAll"),this.prepareVars()?this.checkVarsDependencies()||(this.varsInit=!1,console.log("[zbo] cannot prepare variables (loop into dependency tree)")):(this.varsInit=!1,console.log("[zbo] cannot prepare variables")),this.replaceVars()},prepareVars:function(){for(let e in this.vars)switch(this.vars[e].type){case"Custom_JavaScript":if(!this.prepareVarDependencies(e))return!1;break;case"Random":this.varsDependencies[this.vars[e].name]={val:this.vars[e].value(),parents:{},isFunction:!1,isComputed:!0,custom:!1};break;case"Data_Layer_Variable":this.varsDependencies[this.vars[e].name]={val:"datalayer['"+this.vars[e].value+"']",parents:{},isFunction:!1,isComputed:!0,custom:!1};break;default:this.varsDependencies[this.vars[e].name]={val:this.vars[e].value,parents:{},isFunction:!1,isComputed:!0,custom:!1};break}return!0},prepareVarDependencies:function(e){let n=this.vars[e].name,t=this.vars[e].value,o=!1;typeof t=="function"&&(o=!0,t='"'+t+'"',t=t.replace(this.var_fn_regex,"$3"));do{var s=this.var_regex.exec(t);if(s){if(s[1]===n)return!1;this.varsDependencies[n]||(this.varsDependencies[n]={val:t,parents:{},isFunction:o,isComputed:!1,custom:!0}),this.varsDependencies[n].parents[s[1]]=!0}}while(s)return!0},checkVarsDependencies:function(){for(let e in this.varsDependencies)if(!this.checkVarDependencies(e,e))return!1;return!0},checkVarDependencies:function(e,t){if(!this.varsDependencies[t])return!0;if(!this.varsDependencies[t].parents)return this.varsDependencies[t].isComputed=!0,!0;if(this.varsDependencies[t].parents[e])return!1;for(const[n,s]of Object.entries(this.varsDependencies[t].parents))if(!this.checkVarDependencies(e,n))return!1;let n=this.varsDependencies[t];if(n.isComputed||!n.isFunction)return!0;for(let e in n.parents){let t=this.varsDependencies[e];if(!t)continue;n.val=n.val.replace(new RegExp("{{\\s*"+e+"\\s*}}","g"),t.val)}try{this.varsDependencies[t].val=new Function(n.val.substring(1,n.val.length-1))()}catch(e){console.log("[zbo] cannot eval function",e)}return this.varsDependencies[t].isComputed=!0,!0},replaceVars:function(){for(let t in this.vars){let n=this.vars[t].name,e=this.varsDependencies[n];e&&e.custom&&(this.vars[t].value=e.val)}},exec:function(){if(!this.varsInit){this.debug(0,"error initializing variables");return}clearInterval(this.interId),this._events.length&&this.debug(0,"Executing events...");for(let s in this._events){n=this._events[s].length;for(let i=0;i<n;i++){let o=this._events[s][i]||{};this.debug(0,"> Current event type",s,"with datalayer",o);for(let c in this.tags){let i=this.tags[c];if(i.shouldSkip||i.dependsOn!=void 0&&this.executedTagIDs.indexOf(i.dependsOn)==-1){this.debug(1,"-> Skipping tag",i.id,"as it has already been executed once");continue}let r=!0,a=-1;if(this.debug(1,"-> Processing event for tag",i.id),this.debug(1,"--> Checking Triggers..."),i.triggerIds!=void 0)for(let c of i.triggerIds){var[t,e]=this._checkTrigger(c,s,o,!0),n;t&&(r=!1,a=e!=null&&a==-1||e<a?e:a)}if(r){this.debug(1,">> Triggers didn't match. Skipping tag! <<");continue}if(this.debug(1,"--> Checking ExceptionTriggers..."),i.triggerExceptionIds!=void 0)for(let n of i.triggerExceptionIds){var[t,e]=this._checkTrigger(n,s,o,!1);if(!t){r=!0;break}}if(r){this.debug(1,">> ExceptionTriggers match. Skipping tag! <<");continue}this.debug(1,"--> Preparing execution of tag",i.id),this.execTags(s,i,a,o),this.executedTagIDs.indexOf(i.id)==-1&&this.executedTagIDs.push(i.id),i.onlyOnce&&!i.shouldSkip&&(i.shouldSkip=!0)}}delete this._events[s]}this.interId=setInterval(this.exec.bind(this),500)},execTags:function(e,t,n,s){let o=[];for(let n of t.values)o.push({code:this._render(e,n.code,s),async:n.async,src:n.withSrc,tag:n.tag,style:n.style});if(this.debug(1,"---> Tag values are:",o),n!=null&&n!=0)return this.debug(1,"---> Tag",t.id,"will be executed with a delay of",n),this.timers(t.type,o,n);this.debug(1,"---> Executing tag",t.id),this.appendNodes(t.type,o)},timers:function(e,t,n){for(let s in t)setTimeout(this.appendNode.bind(this,e,s.tag,s.code,s.async),n)},appendNode:function(e,t,n,s,o,i){switch(this.debug(1,"Appending node of type",e+"(async:"+s+", src:"+o+", tag:"+t+", style:"+i+`):
`,n),e){case"Custom_HTML":var a=document.createElement(t);i!=""&&(a.style.cssText=i),s&&a.setAttribute("async",""),o?a.setAttribute("src",n):a.append(n),document.body.append(a);break;case"Custom_Image":a=document.createElement("img"),a.style.display="none",a.src=n,document.body.append(a);break;default:console.error("[ZBO-Reactor] Unknown trigger kind",e)}},appendNodes:function(e,t){for(let n of t)this.appendNode(e,n.tag,n.code,n.async,n.src,n.style)},register:function(e,t){this.debug(0,"Registering event",e,"with datalayer",t||{}),this._events[e]=this._events[e]||[],this._events[e].push(t||{})},_render:function(e,t,n){for(let o in this.vars){let i=this.vars[o].name,s=this.vars[o].value;switch(this.vars[o].type){case"Data_Layer_Variable":s=this._datalayerGet(n,this.vars[o].value,o);break;case"Event":s=e;break;case"Random":s=s();break;default:if(s=this.vars[o].value,typeof s=="function"){let e=s.toString();e=this._datalayerReplacer(e,n),s=new Function("return "+e),s=s()}break}t=t.replace(new RegExp("{{\\s*"+i+"\\s*}}","g"),s)}return t},_datalayerGet:function(e,t){if(Array.isArray(e)){var s=[];return e.forEach(function(e){e.hasOwnProperty(t)&&s.push(e[t])}),s}return e[t]},_datalayerReplacer:function(e,t){for(var n,s=new RegExp(`"datalayer\\['(\\w+)'\\]"`,"gm");n=s.exec(e);)e=e.replace(n[0],"'"+datalayerGet(t,n[1])+"'"),typeof t[n[1]]=="string"?e=e.replace(n[0],"'"+t[n[1]]+"'"):e=e.replace(n[0],"'"+datalayerGet(t,n[1])+"'"),s.lastIndex=0;return e},_checkTrigger:function(e,t,n,s){let o=this.triggers[e];if(o==null)return[!1,null];this.debug(1,"Checking trigger",o);for(let e of o.conditions){let a=this.vars[e.variableId],i;switch(a.type){case"Event":if(i=this._op(e.operator,t,e.compareTo),this.debug(1,"> Condition["+a.type+"] ("+t,e.operator,e.compareTo+") returned",i,"expected",s),i!=s)return[!1,null];break;case"Data_Layer_Variable":if(i=this._op(e.operator,n[a.value],e.compareTo),this.debug(1,"> Condition["+a.type+"] ("+n[a.value],e.operator,e.compareTo+") returned",i,"expected",s),i!=s)return[!1,null];break;case"Custom_JavaScript":case"Constant":case"URL":case"HTTP_Referrer":case"URL_Path":case"URL_Path_full":if(i=this._op(e.operator,a.value,e.compareTo),this.debug(1,"> Condition["+a.type+"] ("+a.value,e.operator,e.compareTo+") returned",i,"expected",s),i!=s)return[!1,null];break;case"Random":if(i=this._op(e.operator,a.value(),e.compareTo),i!=s)return[!1,null];break}}return this.debug(1,"Trigger "+e+" is valid"),[!0,o.type=="Timer"&&o.value?Number(o.value):0]},_op:(e,t,n)=>{switch((t!==Number||n!==Number)&&(t=String(t),n=String(n)),e){case"=":return t==n;case"!=":return t!=n;case"isDefined":return t!=null;case"contains":return t.indexOf(n)!=-1;case"startsWith":return t.startsWith(n);case"endsWith":return t.endsWith(n)}return!1},debug:function(e,...t){this.is_debug&&e<=this.debug_value&&console.debug("[zbo]",...t)}};if(!e._zbo||!e._zbo.init)try{t.init(),e._zbo=t,setTimeout(t.exec.bind(t),100)}catch{}})(this)